<!-- @see https://storybook.js.org/docs/html/configure/story-rendering#adding-to-head -->
<script type="module" src="/pine-core/pine-core.esm.js"></script>
<script nomodule src="/pine-core/index.esm.js"></script>

<link rel="stylesheet" href="/pine-core/pine-core.css" />

<script>
  // Apply theme attribute to document
  const applyTheme = (theme) => {
    document.documentElement.setAttribute('data-theme', theme);
    if (document.body) {
      document.body.setAttribute('data-theme', theme);
    }
  };

  // Get theme from URL globals parameter (Storybook encodes globals in URL)
  const getThemeFromUrl = () => {
    const url = new URL(window.location.href);
    const globals = url.searchParams.get('globals');
    if (globals) {
      // Parse globals format: "theme:dark" or "theme:light;other:value"
      const parts = globals.split(';');
      for (const part of parts) {
        const [key, value] = part.split(':');
        if (key === 'theme' && value) {
          return value;
        }
      }
    }
    return 'light';
  };

  // Apply theme from URL
  const checkAndApplyTheme = () => {
    const theme = getThemeFromUrl();
    applyTheme(theme);
  };

  // Watch for URL changes (when user toggles theme in toolbar)
  let lastUrl = window.location.href;
  const urlObserver = setInterval(() => {
    if (window.location.href !== lastUrl) {
      lastUrl = window.location.href;
      checkAndApplyTheme();
    }
  }, 100);

  // Apply immediately
  checkAndApplyTheme();

  // Re-apply once body is available
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', checkAndApplyTheme);
  }
</script>


<style>
body {
    background-color: var(--pine-color-background-app);
  }

  .sb-unstyled {
    background-color: var(--pine-color-background-app);
  }

  /* Dark mode token overrides - aligned with ds-tokens semantic/dark.json */
  [data-theme="dark"] {
    /* Accent colors */
    --pine-color-accent: var(--pine-color-purple-500);
    --pine-color-accent-disabled: var(--pine-color-purple-100);
    --pine-color-accent-hover: var(--pine-color-purple-600);

    /* Background colors */
    --pine-color-background-app: var(--pine-color-grey-900);
    --pine-color-background-subtle: var(--pine-color-grey-900);
    --pine-color-background-muted: var(--pine-color-grey-800);
    --pine-color-background-inverse-app: var(--pine-color-grey-100);
    --pine-color-background-inverse-subtle: var(--pine-color-grey-150);
    --pine-color-background-inverse-muted: var(--pine-color-grey-200);
    --pine-color-background-inverse-container: var(--pine-color-white);
    --pine-color-background-inverse-inset: var(--pine-color-grey-050);
    --pine-color-background-container: var(--pine-color-black);
    --pine-color-background-container-disabled: var(--pine-color-grey-800);
    --pine-color-background-container-hover: var(--pine-color-grey-950);
    --pine-color-background-inset: var(--pine-color-grey-700);
    --pine-color-background-inset-emphasized: var(--pine-color-grey-600);

    /* Border colors */
    --pine-color-border: var(--pine-color-grey-600);
    --pine-color-border-hover: var(--pine-color-grey-500);
    --pine-color-border-disabled: var(--pine-color-grey-700);
    --pine-color-border-active: var(--pine-color-grey-500);
    --pine-color-border-danger: var(--pine-color-red-600);
    --pine-color-border-danger-hover: var(--pine-color-red-700);
    --pine-color-border-subtle: var(--pine-color-grey-700);

    /* Divider colors */
    --pine-color-divider: var(--pine-color-grey-700);
    --pine-color-divider-strong: var(--pine-color-grey-600);

    /* Status colors */
    --pine-color-danger: var(--pine-color-red-600);
    --pine-color-danger-disabled: var(--pine-color-red-100);
    --pine-color-danger-hover: var(--pine-color-red-700);
    --pine-color-focus-ring: var(--pine-color-purple-300);
    --pine-color-focus-ring-danger: var(--pine-color-red-300);
    --pine-color-info: var(--pine-color-blue-500);
    --pine-color-info-disabled: var(--pine-color-blue-100);
    --pine-color-info-hover: var(--pine-color-blue-600);
    --pine-color-neutral: var(--pine-color-grey-400);
    --pine-color-neutral-disabled: var(--pine-color-grey-900);
    --pine-color-neutral-hover: var(--pine-color-grey-300);
    --pine-color-success: var(--pine-color-green-500);
    --pine-color-success-disabled: var(--pine-color-green-100);
    --pine-color-success-hover: var(--pine-color-green-600);
    --pine-color-warning: var(--pine-color-yellow-500);
    --pine-color-warning-disabled: var(--pine-color-yellow-100);
    --pine-color-warning-hover: var(--pine-color-yellow-600);

    /* Primary/Secondary button colors */
    --pine-color-primary: var(--pine-color-grey-100);
    --pine-color-primary-disabled: var(--pine-color-grey-800);
    --pine-color-primary-hover: var(--pine-color-white);
    --pine-color-secondary: var(--pine-color-black);
    --pine-color-secondary-disabled: var(--pine-color-black);
    --pine-color-secondary-hover: var(--pine-color-grey-950);

    /* Text colors */
    --pine-color-text: var(--pine-color-grey-100);
    --pine-color-text-hover: var(--pine-color-grey-050);
    --pine-color-text-disabled: var(--pine-color-grey-400);
    --pine-color-text-readonly: var(--pine-color-grey-200);
    --pine-color-text-active: var(--pine-color-grey-050);
    --pine-color-text-accent: var(--pine-color-purple-900);
    --pine-color-text-accent-disabled: var(--pine-color-purple-300);
    --pine-color-text-accent-hover: var(--pine-color-purple-950);
    --pine-color-text-danger: var(--pine-color-red-900);
    --pine-color-text-danger-disabled: var(--pine-color-red-300);
    --pine-color-text-danger-hover: var(--pine-color-red-950);
    --pine-color-text-info: var(--pine-color-blue-900);
    --pine-color-text-info-disabled: var(--pine-color-blue-300);
    --pine-color-text-info-hover: var(--pine-color-blue-950);
    --pine-color-text-label: var(--pine-color-grey-050);
    --pine-color-text-label-disabled: var(--pine-color-grey-400);
    --pine-color-text-label-readonly: var(--pine-color-grey-200);
    --pine-color-text-message: var(--pine-color-grey-150);
    --pine-color-text-message-danger: var(--pine-color-red-600);
    --pine-color-text-message-disabled: var(--pine-color-grey-300);
    --pine-color-text-neutral: var(--pine-color-grey-100);
    --pine-color-text-neutral-disabled: var(--pine-color-grey-300);
    --pine-color-text-neutral-hover: var(--pine-color-grey-050);
    --pine-color-text-placeholder: var(--pine-color-grey-300);
    --pine-color-text-placeholder-disabled: var(--pine-color-grey-500);
    --pine-color-text-primary: var(--pine-color-black);
    --pine-color-text-primary-disabled: var(--pine-color-grey-500);
    --pine-color-text-secondary: var(--pine-color-grey-150);
    --pine-color-text-secondary-disabled: var(--pine-color-grey-500);
    --pine-color-text-secondary-hover: var(--pine-color-grey-100);
    --pine-color-text-tertiary: var(--pine-color-grey-300);
    --pine-color-text-tertiary-disabled: var(--pine-color-grey-500);
    --pine-color-text-subtle: var(--pine-color-grey-400);
    --pine-color-text-subtle-disabled: var(--pine-color-grey-600);
    --pine-color-text-muted: var(--pine-color-grey-200);
    --pine-color-text-muted-disabled: var(--pine-color-grey-400);
    --pine-color-text-strong: var(--pine-color-grey-050);
    --pine-color-text-strong-disabled: var(--pine-color-grey-300);
    --pine-color-text-emphasis: var(--pine-color-white);
    --pine-color-text-inverse: var(--pine-color-grey-900);
    --pine-color-text-inverse-secondary: var(--pine-color-grey-800);
    --pine-color-text-inverse-tertiary: var(--pine-color-grey-600);
    --pine-color-text-inverse-emphasis: var(--pine-color-black);
    --pine-color-text-success: var(--pine-color-green-900);
    --pine-color-text-success-disabled: var(--pine-color-green-300);
    --pine-color-text-success-hover: var(--pine-color-green-950);
    --pine-color-text-warning: var(--pine-color-yellow-900);
    --pine-color-text-warning-disabled: var(--pine-color-yellow-300);
    --pine-color-text-warning-hover: var(--pine-color-yellow-950);

    /* Icon colors */
    --pine-color-icon: var(--pine-color-grey-200);
    --pine-color-icon-subtle: var(--pine-color-grey-400);
    --pine-color-icon-disabled: var(--pine-color-grey-500);
    --pine-color-icon-inverse: var(--pine-color-grey-900);

    /* Brand colors */
    --pine-color-brand: var(--pine-color-black);

    /* Border shorthand */
    --pine-border: var(--pine-border-width-thin) solid var(--pine-color-grey-600);
    --pine-border-hover: var(--pine-border-width-thin) solid var(--pine-color-grey-400);
    --pine-border-none: var(--pine-border-width-none) solid var(--pine-color-grey-600);
  }

  /* Dark mode styles for Storybook docs */
  [data-theme="dark"] .sbdocs,
  [data-theme="dark"] .docs-story {
    background-color: #1a1a1a;
    color: #e0e0e0;
  }

  [data-theme="dark"] .sbdocs-wrapper {
    background-color: #1a1a1a;
  }

  [data-theme="dark"] .sbdocs-content {
    background-color: #1a1a1a;
    color: #e0e0e0;
  }

  [data-theme="dark"] .docblock-argstable .docblock-argstable-body > tr > * {
    background-color: #2d2d2d;
  }

  /* Docs headings */
  [data-theme="dark"] .sbdocs h1,
  [data-theme="dark"] .sbdocs h2,
  [data-theme="dark"] .sbdocs h3,
  [data-theme="dark"] .sbdocs h4,
  [data-theme="dark"] .sbdocs h5,
  [data-theme="dark"] .sbdocs h6 {
    color: #ffffff;
  }

  /* Docs paragraphs and text */
  [data-theme="dark"] .sbdocs p,
  [data-theme="dark"] .sbdocs li,
  [data-theme="dark"] .sbdocs span {
    /* color: #d0d0d0; */
    color: #e0e0e0;;
  }

  /* Docs links */
  [data-theme="dark"] .sbdocs a {
    color: #6b9f36;
  }

  [data-theme="dark"] .sbdocs a:hover {
    color: #8bc34a;
  }

  /* Docs code blocks */
  [data-theme="dark"] .sbdocs pre,
  [data-theme="dark"] .sbdocs code {
    background-color: #2d2d2d;
    color: #e0e0e0;
  }

  [data-theme="dark"] .sbdocs pre {
    border-color: #404040;
  }

  /* Docs tables */
  [data-theme="dark"] .sbdocs table {
    background-color: #252525;
  }

  [data-theme="dark"] .sbdocs th {
    background-color: #2d2d2d;
    color: #ffffff;
    border-color: #404040;
  }

  [data-theme="dark"] .sbdocs td {
    border-color: #404040;
    color: #d0d0d0;
  }

  [data-theme="dark"] .sbdocs tr:nth-child(even) {
    background-color: #2a2a2a;
  }

  /* Docs blockquotes */
  [data-theme="dark"] .sbdocs blockquote {
    background-color: #252525;
    border-left-color: #6b9f36;
    color: #b0b0b0;
  }

  /* Docs horizontal rules */
  [data-theme="dark"] .sbdocs hr {
    border-color: #404040;
  }

  /* ArgTypes/Props table */
  [data-theme="dark"] .docblock-argstable {
    background-color: #252525;
  }

  [data-theme="dark"] .docblock-argstable th,
  [data-theme="dark"] .docblock-argstable td {
    border-color: #404040;
    color: #d0d0d0;
  }

  [data-theme="dark"] .docblock-argstable thead {
    background-color: #2d2d2d;
  }

  [data-theme="dark"] .docblock-argstable thead th {
    color: #ffffff;
  }

  /* Story canvas/preview area */
  [data-theme="dark"] .innerZoomElementWrapper > div {
    background-color: #1a1a1a;
  }

  /* Unstyled stories container */
  [data-theme="dark"] .sb-unstyled {
    background-color: #1a1a1a;
  }

  [data-theme="dark"] .args-table {
    background-color: #1a1a1a;
  }

  [data-theme="dark"] .sbdocs-content .args-table-header {
    color: #e0e0e0;
  }

  [data-theme="dark"] .sbdocs-content .arg-table-cell {
    color: #e0e0e0;
  }

  [data-theme="dark"] .sbdocs-content .docblock-argstable-body button + span {
    color: #2e3338;
  }

  [data-theme="dark"] .sbdocs-content .docblock-argstable-body input + span + span {
    color: #2e3338;
  }
</style>