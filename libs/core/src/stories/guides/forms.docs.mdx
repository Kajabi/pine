import { Meta } from '@storybook/blocks';
import { DocCanvas } from '@pine-ds/doc-components';

<Meta title="Guides/Forms" />

# Using Pine Form Components

## Overview

Pine Design System (PDS) form components such as `pds-input`, `pds-checkbox`, `pds-button`, `pds-radio`, `pds-switch`, and `pds-textarea` are designed to work seamlessly within standard HTML `<form>` elements. These components ensure accessibility and consistency while providing enhanced styling and behavior.

## Examples for Demo Purposes

> ***The examples provided on this page demonstrate how to integrate Pine components into a form. These are for demonstration purposes only and are not intended for production use.***

Specifically:

- The examples log form data to the browser's console using `console.log()`.
- Default values are displayed if the fields are not modified.
- In production, replace the logging mechanism with proper form handling logic, such as API calls or state management integration.

## Form Example Walkthrough

### React Example

The React implementation demonstrates a controlled form with state management using the `useState` hook. It highlights how to manage form data and handle validation for required fields like `name` and `email`.

### Web Component Example

The web component example utilizes vanilla JavaScript to access values directly from DOM elements. This implementation shows how Pine components can be integrated with native JavaScript without relying on a framework.

> **Note:** Be mindful of best practices for validation and form submission when using these examples as a reference.

> **💡 Open your browser's developer console before submitting the form to see detailed debugging output!**

<DocCanvas client:only
  mdxSource={{
    react: `
      import React, { useState } from 'react';

      const FormComponent = () => {
        const [formData, setFormData] = useState({
          name: '',
          email: '',
          subscribe: false,
          direction: '',
          notifications: false,
          message: '',
          timeOfDay: '',
        });

        const handleSubmit = (e) => {
          e.preventDefault();
          // Validate required fields
          const { name, email, subscribe, direction, notifications, message, timeOfDay } = formData;
          if (!name || !email) {
            alert('Please fill out all required fields');
            return;
          }
          console.log('Form Data:', JSON.stringify({ name, email, subscribe, direction, notifications, message, timeOfDay }));
        };

        const handleChange = (e) => {
          const { name, value, type, checked } = e.target;
          setFormData((prevData) => ({
            ...prevData,
            [name]: type === 'checkbox' || type === 'radio' ? checked : value,
          }));
        };

        return (
          <pds-box display="block" padding="lg" margin="md" border border-radius="lg">
            {/* Vertical Layout for form components */}
            <form onSubmit={handleSubmit}>
              {/* Name Input */}
              <pds-box display="block" padding="sm" margin="sm">
                <pds-input
                  component-id="name"
                  label="Name"
                  type="text"
                  name="name"
                  value={formData.name}
                  onChange={handleChange}
                />
              </pds-box>

              {/* Email Input */}
              <pds-box display="block" padding="sm" margin="sm">
                <pds-input
                  component-id="email"
                  label="Email"
                  type="email"
                  name="email"
                  value={formData.email}
                  onChange={handleChange}
                />
              </pds-box>

              {/* Subscribe Checkbox */}
              <pds-box display="block" padding="sm" margin="sm">
                <pds-checkbox
                  component-id="subscribe"
                  label="Subscribe to newsletter"
                  name="subscribe"
                  checked={formData.subscribe}
                  onChange={handleChange}
                />
              </pds-box>

              {/* Direction Radio Buttons */}
              <pds-box display="block" padding="sm" margin="sm">
                <pds-radio
                  component-id="direction-up"
                  label="Up"
                  name="direction"
                  value="up"
                  checked={formData.direction === 'up'}
                  onChange={handleChange}
                />
                <pds-radio
                  component-id="direction-down"
                  label="Down"
                  name="direction"
                  value="down"
                  checked={formData.direction === 'down'}
                  onChange={handleChange}
                />
              </pds-box>

              {/* Notifications Switch */}
              <pds-box display="block" padding="sm" margin="sm">
                <pds-switch
                  component-id="notifications"
                  label="Enable notifications"
                  name="notifications"
                  checked={formData.notifications}
                  onChange={handleChange}
                />
              </pds-box>

              {/* Time of Day Select */}
              <pds-box display="block" padding="sm" margin="sm">
                <pds-select
                  component-id="timeOfDay"
                  label="Favorite Time of Day"
                  name="timeOfDay"
                  value={formData.timeOfDay}
                  onChange={handleChange}
                >
                  <option value="">Select...</option>
                  <option value="morning">Morning</option>
                  <option value="noon">Noon</option>
                  <option value="night">Night</option>
                </pds-select>
              </pds-box>

              {/* Message Textarea */}
              <pds-box display="block" padding="sm" margin="sm">
                <pds-textarea
                  component-id="message"
                  label="Message"
                  name="message"
                  value={formData.message}   // Bind the textarea value to the state
                  onChange={handleChange}    // Use the same handler to update the state
                />
              </pds-box>

              {/* Submit Button */}
              <pds-box display="block" padding="sm" margin="sm">
                <pds-button type="submit" variant="primary">Submit Form</pds-button>
              </pds-box>
            </form>
          </pds-box>
        );
      };

      export default FormComponent;
    `,
    webComponent: `
      <pds-box display="block" padding="lg" margin="md" border border-radius="lg">
        <form onSubmit={(e) => {
          e.preventDefault();
          const form = e.target;
          console.log('Form Data:', {
            name: form.querySelector('[component-id="name"]').value,
            email: form.querySelector('[component-id="email"]').value,
            subscribe: form.querySelector('[component-id="subscribe"]').checked,
            direction: form.querySelector('input[name="direction"]:checked')?.value,
            notifications: form.querySelector('[component-id="notifications"]').checked,
            message: form.querySelector('[component-id="message"]').value,
            timeOfDay: form.querySelector('[component-id="timeOfDay"]').value
          });
        }}>
          <pds-box display="block" padding="sm">
            <pds-input component-id="name" label="Name" type="text"></pds-input>
          </pds-box>

          <pds-box display="block" padding="sm">
            <pds-input component-id="email" label="Email" type="email"></pds-input>
          </pds-box>

          <pds-box display="block" padding="sm">
            <pds-checkbox component-id="subscribe" label="Subscribe to newsletter"></pds-checkbox>
          </pds-box>

          <pds-box display="flex" padding="sm" gap="sm">
            <p><strong>Favorite direction:</strong></p>
            <pds-radio component-id="direction-up" label="Up" name="direction" value="up"></pds-radio>
            <pds-radio component-id="direction-down" label="Down" name="direction" value="down"></pds-radio>
          </pds-box>

          <pds-box display="block" padding="sm">
            <pds-switch component-id="notifications" label="Enable notifications"></pds-switch>
          </pds-box>

          <pds-box display="block" padding="sm">
            <pds-select component-id="timeOfDay" label="Favorite Time of Day" name="timeOfDay">
              <option value="">Select...</option>
              <option value="morning">Morning</option>
              <option value="noon">Noon</option>
              <option value="night">Night</option>
            </pds-select>
          </pds-box>

          <pds-box display="block" padding="sm">
            <pds-textarea component-id="message" label="Message"></pds-textarea>
          </pds-box>

          <pds-box display="block" padding="sm">
            <pds-button type="submit" variant="primary">Submit Form</pds-button>
          </pds-box>
        </form>
      </pds-box>
    `
}}>

<pds-box display="block" padding="lg" margin="md" border border-radius="lg">
  <form onSubmit={(e) => {
    e.preventDefault();
    const form = e.target;

    console.log('🚀 Form submitted! Check console for detailed debugging info...');
    console.log('═══════════════════════════════════════════════════');

    // Log FormData (includes form-associated custom elements)
    const formData = new FormData(form);
    console.log('📝 FormData entries:');
    for (let [key, value] of formData.entries()) {
      console.log(`  ${key}: ${value}`);
    }

    // Log component values directly
    console.log('🎯 Component values:', {
      name: form.querySelector('[component-id="name"]')?.value,
      email: form.querySelector('[component-id="email"]')?.value,
      subscribe: form.querySelector('[component-id="subscribe"]')?.checked,
      direction: form.querySelector('input[name="direction"]:checked')?.value,
      notifications: form.querySelector('[component-id="notifications"]')?.checked,
      message: form.querySelector('[component-id="message"]')?.value,
      timeOfDay: form.querySelector('[component-id="timeOfDay"]')?.value
    });

    // Log native form elements
    console.log('🔍 Native form elements:', {
      elements: Array.from(form.elements).map(el => ({
        name: el.name,
        value: el.value,
        type: el.type,
        tagName: el.tagName.toLowerCase()
      }))
    });

    console.log('═══════════════════════════════════════════════════');

    // Also check form association status
    console.log('🔍 Form association diagnostic:');

    // Check custom element definitions
    console.log('📦 Custom element definitions:', {
      'pds-input': customElements.get('pds-input') ? '✅ Defined' : '❌ Not defined',
      'pds-select': customElements.get('pds-select') ? '✅ Defined' : '❌ Not defined',
      'pds-textarea': customElements.get('pds-textarea') ? '✅ Defined' : '❌ Not defined',
      'pds-checkbox': customElements.get('pds-checkbox') ? '✅ Defined' : '❌ Not defined',
      'pds-radio': customElements.get('pds-radio') ? '✅ Defined' : '❌ Not defined',
      'pds-switch': customElements.get('pds-switch') ? '✅ Defined' : '❌ Not defined'
    });

    // Check if Pine components have form association
    const formComponents = {
      input: form.querySelector('pds-input[component-id="name"]'),
      email: form.querySelector('pds-input[component-id="email"]'),
      subscribe: form.querySelector('pds-checkbox[component-id="subscribe"]'),
      direction: form.querySelector('pds-radio[component-id="direction-up"]'),
      notifications: form.querySelector('pds-switch[component-id="notifications"]'),
      select: form.querySelector('pds-select[component-id="timeOfDay"]'),
      textarea: form.querySelector('pds-textarea[component-id="message"]')
    };

    console.log('🌲 Pine components in form:', Object.keys(formComponents).reduce((acc, key) => {
      acc[key] = formComponents[key] ? '✅ Found' : '❌ Not found';
      return acc;
    }, {}));

    // Check form association status
    console.log('✅ Form association status:', Object.keys(formComponents).reduce((acc, key) => {
      const component = formComponents[key];
      if (component) {
        acc[key] = component.constructor?.formAssociated ? '✅ Associated' : '❌ Not associated';
      }
      return acc;
    }, {}));

  }}>
    <pds-box display="block" padding="sm">
      <pds-input component-id="name" name="name" label="Name" type="text"></pds-input>
    </pds-box>

    <pds-box display="block" padding="sm">
      <pds-input component-id="email" name="email" label="Email" type="email"></pds-input>
    </pds-box>

    <pds-box display="block" padding="sm">
      <pds-checkbox component-id="subscribe" name="subscribe" label="Subscribe to newsletter"></pds-checkbox>
    </pds-box>

    <pds-box display="flex" padding="sm" gap="sm">
      <p><strong>Favorite direction:</strong></p>
      <pds-radio component-id="direction-up" label="Up" name="direction" value="up"></pds-radio>
      <pds-radio component-id="direction-down" label="Down" name="direction" value="down"></pds-radio>
    </pds-box>

    <pds-box display="block" padding="sm">
      <pds-switch component-id="notifications" name="notifications" label="Enable notifications"></pds-switch>
    </pds-box>

    <pds-box display="block" padding="sm">
      <pds-select component-id="timeOfDay" label="Favorite Time of Day" name="timeOfDay">
        <option value="">Select an option...</option>
        <option value="morning">Morning</option>
        <option value="noon">Noon</option>
        <option value="night">Night</option>
      </pds-select>
    </pds-box>

    <pds-box display="block" padding="sm">
      <pds-textarea component-id="message" name="message" label="Message"></pds-textarea>
    </pds-box>

    <pds-box display="block" padding="sm">
      <pds-button type="submit" variant="primary">Submit Form</pds-button>
    </pds-box>
  </form>
</pds-box>

</DocCanvas>

## Debugging and Testing Form Association

Pine components use the **Form Associated Custom Elements API** to properly integrate with native HTML forms. This ensures that Pine form components participate in form submission, validation, and reset operations.

### Comprehensive Form Debugging Example

Here's a comprehensive debugging setup that helps verify form association is working correctly:

```html
<script>
document.addEventListener('DOMContentLoaded', () => {
  const form = document.querySelector('form');

  if (form) {
    // Check custom element definitions on page load
    setTimeout(() => {
      console.log('🔍 Checking if custom elements are defined...');
      console.log('pds-input defined:', customElements.get('pds-input'));
      console.log('pds-select defined:', customElements.get('pds-select'));
      console.log('pds-textarea defined:', customElements.get('pds-textarea'));

      console.log('📊 Testing form elements access:');
      console.log('Form elements:', form.elements);
      console.log('Form elements length:', form.elements.length);
      console.log('Named elements:', {
        name: form.elements.namedItem('name'),
        email: form.elements.namedItem('email'),
        message: form.elements.namedItem('message')
      });

      // Check if Pine components have form association
      const pdsInput = document.querySelector('pds-input');
      const pdsSelect = document.querySelector('pds-select');
      const pdsTextarea = document.querySelector('pds-textarea');

      console.log('🌲 Pine components in DOM:', {
        input: pdsInput,
        select: pdsSelect,
        textarea: pdsTextarea
      });

      if (pdsInput || pdsSelect || pdsTextarea) {
        console.log('🔧 Component internals:', {
          inputInternals: pdsInput?.internals,
          selectInternals: pdsSelect?.internals,
          textareaInternals: pdsTextarea?.internals
        });

        // Check if components are form-associated
        console.log('✅ Form association check:', {
          inputFormAssociated: pdsInput?.constructor?.formAssociated,
          selectFormAssociated: pdsSelect?.constructor?.formAssociated,
          textareaFormAssociated: pdsTextarea?.constructor?.formAssociated
        });
      } else {
        console.error('❌ No Pine components found in DOM! Check if components are loading properly.');
      }
    }, 2000); // Wait for components to load

    // Enhanced form submission debugging
    form.addEventListener('submit', (e) => {
      e.preventDefault();

      console.log('🚀 Form submitted!');

      // Log FormData (includes form-associated custom elements)
      const formData = new FormData(form);
      console.log('📝 FormData entries:');
      for (let [key, value] of formData.entries()) {
        console.log(`  ${key}: ${value}`);
      }

      // Log component values directly
      console.log('🎯 Component values:', {
        name: form.querySelector('[name="name"]')?.value,
        email: form.querySelector('[name="email"]')?.value,
        message: form.querySelector('[name="message"]')?.value
      });

      // Log native form elements
      console.log('🔍 Native form elements:', {
        elements: Array.from(form.elements).map(el => ({
          name: el.name,
          value: el.value,
          type: el.type,
          tagName: el.tagName.toLowerCase()
        }))
      });
    });
  }
});
</script>
```

### What to Look For

When debugging Pine forms, check for these indicators of successful form association:

1. **Custom Elements Defined**: All Pine components should be registered
   ```javascript
   console.log('pds-input defined:', customElements.get('pds-input')); // Should return constructor
   ```

2. **Form Association Active**: Components should have `formAssociated: true`
   ```javascript
   console.log('Form associated:', pdsInput?.constructor?.formAssociated); // Should be true
   ```

3. **Form Elements Collection**: Pine components should appear in `form.elements`
   ```javascript
   console.log('Form elements count:', form.elements.length); // Should include Pine components
   ```

4. **FormData Inclusion**: Pine component values should appear in FormData
   ```javascript
   const formData = new FormData(form);
   for (let [key, value] of formData.entries()) {
     console.log(`${key}: ${value}`); // Should include Pine component values
   }
   ```

### Common Issues and Solutions

- **Components not in FormData**: Ensure components have `name` attributes
- **Form association not working**: Check that Pine components are fully loaded before form submission
- **Missing values**: Verify that component values are being set properly and internals are initialized

## Guidelines and Recommendations

### 1. Use Pine Components for Consistency

- Incorporating `pds-*` components ensures your forms maintain visual and functional consistency across your application.
- Each component has documentation that outlines its usage and properties. Refer to each component in the sidebar for more information.

### 2. Validation

- Implement robust validation to meet user expectations.
- Use the `required` attribute for mandatory fields.

### 3. Production-Ready Practices

- Avoid logging sensitive user data to the console.
- Replace placeholder code with API integrations or backend logic.
- Ensure error handling is user-friendly and complies with accessibility standards.
