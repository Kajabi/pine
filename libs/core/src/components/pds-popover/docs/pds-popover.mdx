import { Meta, Canvas, Controls } from '@storybook/addon-docs/blocks';
import * as stories from '../stories/pds-popover.stories.js';

import { DocArgsTable, DocCanvas } from '@pine-ds/doc-components';
import { components } from '../../../../dist/docs.json';

<Meta of={stories} />

# Popover
Popovers display contextual information when users click or initiates a keyboard event on an element. They typically contain more information than tooltips and can include interactive elements.

## Guidelines

#### When to use

- Use popovers for complex information that might overwhelm the main content
- When content needs to include interactive elements
- For non-essential information that requires user interaction to display

#### When not to use

- Don't use popovers for critical information that must be readily available
- Avoid using for simple text-only tooltips
- Don't nest popovers within other popovers

## Usage Notes

Keep popover content concise and ensure every trigger element is focusable so keyboard users can open and dismiss the overlay reliably.

## Properties

<DocArgsTable componentName="pds-popover" docSource={components} />

## Examples

### Trigger Slot

Use the `trigger` slot to provide the element that will open the popover. You can use any Pine component - buttons, chips, avatars, or other interactive elements.

<DocCanvas
  mdxSource={{
    react: `
      <PdsBox display="flex" gap="md" align-items="center" flex-wrap="wrap">
        <PdsPopover componentId="button-trigger" placement="bottom-start" popoverTargetAction="toggle">
          <PdsButton slot="trigger">Button Trigger</PdsButton>
          <p>Popover content is displayed here</p>
        </PdsPopover>

        <PdsPopover componentId="icon-trigger" placement="bottom-start" popoverTargetAction="toggle">
          <PdsButton slot="trigger" variant="secondary" iconOnly icon="info-circle" ariaLabel="Information" />
          <p>Popover content is displayed here</p>
        </PdsPopover>

        <PdsPopover componentId="chip-trigger" placement="bottom-start" popoverTargetAction="toggle">
          <PdsChip slot="trigger" variant="dropdown">Chip Trigger</PdsChip>
          <p>Popover content is displayed here</p>
        </PdsPopover>

        <PdsPopover componentId="avatar-trigger" placement="bottom-start" popoverTargetAction="toggle">
          <PdsAvatar slot="trigger" name="John Doe" size="md" dropdown={true} />
          <p>Popover content is displayed here</p>
        </PdsPopover>
      </PdsBox>
    `,
    webComponent: `
      <pds-box display="flex" gap="md" align-items="center" flex-wrap="wrap">
        <pds-popover component-id="button-trigger" placement="bottom-start" popover-target-action="toggle">
          <pds-button slot="trigger">Button Trigger</pds-button>
          <p>Popover content is displayed here</p>
        </pds-popover>

        <pds-popover component-id="icon-trigger" placement="bottom-start" popover-target-action="toggle">
          <pds-button slot="trigger" variant="secondary" icon-only icon="info-circle" aria-label="Information"></pds-button>
          <p>Popover content is displayed here</p>
        </pds-popover>

        <pds-popover component-id="chip-trigger" placement="bottom-start" popover-target-action="toggle">
          <pds-chip slot="trigger" variant="dropdown">Chip Trigger</pds-chip>
          <p>Popover content is displayed here</p>
        </pds-popover>

        <pds-popover component-id="avatar-trigger" placement="bottom-start" popover-target-action="toggle">
          <pds-avatar slot="trigger" name="John Doe" size="md" dropdown="true"></pds-avatar>
          <p>Popover content is displayed here</p>
        </pds-popover>
      </pds-box>
    `
  }}>
  <pds-box display="flex" gap="md" align-items="center" flex-wrap="wrap">
    <pds-popover component-id="button-trigger" placement="bottom-start" popover-target-action="toggle">
      <pds-button slot="trigger">Button Trigger</pds-button>
      <p>Popover content is displayed here</p>
    </pds-popover>

    <pds-popover component-id="icon-trigger" placement="bottom-start" popover-target-action="toggle">
      <pds-button slot="trigger" variant="secondary" icon-only icon="info-circle" aria-label="Information"></pds-button>
      <p>Popover content is displayed here</p>
    </pds-popover>

    <pds-popover component-id="chip-trigger" placement="bottom-start" popover-target-action="toggle">
      <pds-chip slot="trigger" variant="dropdown">Chip Trigger</pds-chip>
      <p>Popover content is displayed here</p>
    </pds-popover>

    <pds-popover component-id="avatar-trigger" placement="bottom-start" popover-target-action="toggle">
      <pds-avatar slot="trigger" name="John Doe" size="md" dropdown="true"></pds-avatar>
      <p>Popover content is displayed here</p>
    </pds-popover>
  </pds-box>
</DocCanvas>

### Behavior Types

#### Auto (Default)

Closes automatically when clicking outside the popover content. Can also be closed by pressing the `Escape` key.

<DocCanvas
  mdxSource={{
    react: `
      <PdsPopover componentId="auto" placement="bottom-start">
        <PdsButton slot="trigger">Auto Popover</PdsButton>
        <p>Clicks outside will close this popover</p>
      </PdsPopover>
    `,
    webComponent: `
      <pds-popover component-id="auto" placement="bottom-start">
        <pds-button slot="trigger">Auto Popover</pds-button>
        <p>Clicks outside will close this popover</p>
      </pds-popover>
    `
  }}>
  <pds-popover component-id="auto" placement="bottom-start">
    <pds-button slot="trigger">Auto Popover</pds-button>
    <p>Clicks outside will close this popover</p>
  </pds-popover>
</DocCanvas>

#### Manual

Popovers with the `popoverType="manual"` require explicit user interaction to close. This means they won't automatically disappear when clicking outside or pressing Escape.

The `popoverTargetAction` property determines how the trigger button interacts with the popover:
- `show`: Only shows the popover (default)
- `hide`: Only hides the popover
- `toggle`: Alternates between showing and hiding

For manual popovers, using `popoverTargetAction="toggle"` is recommended as it allows users to both open and close the popover using the trigger button.

Learn more about popover target actions in the [MDN Documentation](https://developer.mozilla.org/en-US/docs/Web/API/HTMLButtonElement/popoverTargetAction#showhide_popover_action_with_a_manual_popover).

<DocCanvas
  mdxSource={{
    react: `
      <PdsPopover componentId="manual" placement="bottom-start" popoverTargetAction="toggle" popoverType="manual">
        <PdsButton slot="trigger">Manual Popover</PdsButton>
        <p>This popover requires explicit closing</p>
      </PdsPopover>
    `,
    webComponent: `
      <pds-popover component-id="manual" placement="bottom-start" popover-target-action="toggle" popover-type="manual">
        <pds-button slot="trigger">Manual Popover</pds-button>
        <p>This popover requires explicit closing</p>
      </pds-popover>
    `
  }}>
  <pds-popover component-id="manual" placement="bottom-start" popover-target-action="toggle" popover-type="manual">
    <pds-button slot="trigger">Manual Popover</pds-button>
    <p>This popover requires explicit closing</p>
  </pds-popover>
</DocCanvas>

### Target Actions

The `popoverTargetAction` prop determines how the trigger button interacts with the popover.

#### Show (Default)

Shows the popover when triggered. Clicking the popover trigger while open will not close the popover.

<DocCanvas
  mdxSource={{
    react: `
      <PdsPopover componentId="show" placement="bottom-start">
        <PdsButton slot="trigger">Show Action</PdsButton>
        <p>This popover uses the show action</p>
      </PdsPopover>
    `,
    webComponent: `
      <pds-popover component-id="show" placement="bottom-start">
        <pds-button slot="trigger">Show Action</pds-button>
        <p>This popover uses the show action</p>
      </pds-popover>
    `
  }}>
  <pds-popover component-id="show" placement="bottom-start">
    <pds-button slot="trigger">Show Action</pds-button>
    <p>This popover uses the show action</p>
  </pds-popover>
</DocCanvas>

#### Toggle

Toggles the popover visibility state when triggered. Clicking the popover trigger while open will close the popover.

<DocCanvas
  mdxSource={{
    react: `
      <PdsPopover componentId="toggle" placement="bottom-start" popoverTargetAction="toggle">
        <PdsButton slot="trigger">Toggle Action</PdsButton>
        <p>This popover uses the toggle action</p>
      </PdsPopover>
    `,
    webComponent: `
      <pds-popover component-id="toggle" placement="bottom-start" popover-target-action="toggle">
        <pds-button slot="trigger">Toggle Action</pds-button>
        <p>This popover uses the toggle action</p>
      </pds-popover>
    `
  }}>
  <pds-popover component-id="toggle" placement="bottom-start" popover-target-action="toggle">
    <pds-button slot="trigger">Toggle Action</pds-button>
    <p>This popover uses the toggle action</p>
  </pds-popover>
</DocCanvas>

### Width/Sizing

The `max-width` prop allows adjusting the maximum width of the popover content. Default is 352px.

<DocCanvas
  mdxSource={{
    react: `
      <PdsPopover componentId="wide" placement="bottom-start" maxWidth="520px">
        <PdsButton slot="trigger">Wide Popover</PdsButton>
        <p>This is a wider popover with more content space available.</p>
      </PdsPopover>
    `,
    webComponent: `
      <pds-popover component-id="wide" placement="bottom-start" max-width="520px">
        <pds-button slot="trigger">Wide Popover</pds-button>
        <p>This is a wider popover with more content space available.</p>
      </pds-popover>
    `
  }}>
  <pds-popover component-id="wide" placement="bottom-start" max-width="520px">
    <pds-button slot="trigger">Wide Popover</pds-button>
    <p>This is a wider popover with more content space available.</p>
  </pds-popover>
</DocCanvas>

## Technical Notes

- The trigger slot automatically receives `aria-expanded` and `aria-controls` attributes when the component is hydrated. Use focusable elements (buttons, chips, avatar with `dropdown="true"`, etc.) so that keyboard users can open the popover with Enter or Space.
- Content is teleported to `document.body` via a portal to ensure it is correctly layered above other UI. Because the markup is outside the component's DOM tree, associate it with the trigger via `aria-labelledby` or `aria-describedby` when the content needs more context (for example, referencing the trigger text).
- Auto popovers (`popover-type="auto"`) listen for outside clicks and Escape to close the overlay. Manual popovers must expose their own dismissal affordanceâ€”include a close button in the content and wire it to `popover.hide()`.

## Playground

<Canvas of={stories.Default} />

<Controls of={stories.Default} />
